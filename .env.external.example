# =============================================================================
# Environment Configuration - EXTERNAL (SAML 2.0 / Alberta.ca Account)
# =============================================================================
# This configuration is for public-facing government applications using
# SAML 2.0 authentication for citizens via Alberta.ca Account.
#
# Copy this file to .env and fill in the values from your SAML Identity Provider.
#
# PLACEHOLDER PATTERN: Values wrapped in {{VARIABLE_NAME}} are placeholders.
# Replace them with your actual values (remove the {{ }} brackets).
# Example: {{YOUR_SAML_IDP_SSO_URL}} → https://idp.example.com/saml/sso
#
# See docs/AUTH-SETUP.md for detailed setup instructions.
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
NODE_ENV=production
PORT=3000
APP_NAME=Alberta Government Public Application

# -----------------------------------------------------------------------------
# Session Management (Redis)
# -----------------------------------------------------------------------------
# Generate a secure random string (32+ characters) for production
# Example: openssl rand -base64 32
SESSION_SECRET={{GENERATE_WITH_OPENSSL_RAND_BASE64_32}}
SESSION_STORE=redis

# Redis Authentication Mode
# Option 1: Access Key (simple connection string — good for dev/test)
# REDIS_AUTH_MODE=accesskey
# REDIS_URL=rediss://:{{ACCESS_KEY}}@{{HOSTNAME}}.redis.cache.windows.net:6380
#
# Option 2: Entra ID (recommended for UAT/PROD — passwordless)
REDIS_AUTH_MODE=entraid
REDIS_HOST={{AZURE_REDIS_HOSTNAME}}
REDIS_PORT=6380
REDIS_USERNAME={{MANAGED_IDENTITY_OBJECT_ID}}
# Azure credentials auto-discovered via DefaultAzureCredential
# (Managed Identity on Azure, or AZURE_CLIENT_ID/TENANT_ID/CLIENT_SECRET locally)

# -----------------------------------------------------------------------------
# Authentication - SAML 2.0 (Alberta.ca Account)
# -----------------------------------------------------------------------------
AUTH_DRIVER=saml

# Callback URL - where SAML IdP redirects after authentication (Assertion Consumer Service URL)
# Must match the ACS URL configured in your SAML Identity Provider
# Format: https://your-domain.alberta.ca/api/v1/auth/callback
AUTH_CALLBACK_URL=https://public.app.alberta.ca/api/v1/auth/callback

# SAML IdP Entry Point (SSO URL)
# The URL where users are redirected to authenticate with the Identity Provider
# Example: https://idp.example.com/saml/sso
SAML_ENTRY_POINT={{YOUR_SAML_IDP_SSO_URL}}

# SAML Issuer (Entity ID)
# Unique identifier for your application (Service Provider)
# Format: urn:alberta:{app-name}:{environment}
SAML_ISSUER=urn:alberta:app:external

# SAML IdP Certificate (X.509)
# Public certificate from your Identity Provider (PEM format, base64 encoded)
SAML_CERT={{YOUR_IDP_CERTIFICATE_BASE64}}

# Optional: SAML Service Provider Private Key
# SAML_PRIVATE_KEY={{YOUR_SP_PRIVATE_KEY_BASE64}}

# Optional: SAML Service Provider Certificate
# SAML_CERT_SP={{YOUR_SP_CERTIFICATE_BASE64}}

# -----------------------------------------------------------------------------
# SAML Attribute Mapping (defaults shown — uncomment to customize)
# -----------------------------------------------------------------------------
# SAML_ATTRIBUTE_ID=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier
# SAML_ATTRIBUTE_EMAIL=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress
# SAML_ATTRIBUTE_NAME=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name
# SAML_ATTRIBUTE_FIRST_NAME=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname
# SAML_ATTRIBUTE_LAST_NAME=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname
# SAML_ATTRIBUTE_ROLES=http://schemas.microsoft.com/ws/2008/06/identity/claims/role
# SAML_DEFAULT_ROLE=citizen

# -----------------------------------------------------------------------------
# SAML Logout (optional)
# -----------------------------------------------------------------------------
# SAML_LOGOUT_URL={{YOUR_SAML_IDP_LOGOUT_URL}}
# SAML_LOGOUT_CALLBACK_URL=https://public.app.alberta.ca/api/v1/auth/logout/callback

# -----------------------------------------------------------------------------
# Frontend
# -----------------------------------------------------------------------------
WEB_URL=https://public.app.alberta.ca
CORS_ORIGIN=https://public.app.alberta.ca

# -----------------------------------------------------------------------------
# API Gateway (BFF Proxy to Private Backend)
# -----------------------------------------------------------------------------
PRIVATE_API_BASE_URL={{PRIVATE_BACKEND_URL}}
OAUTH_TENANT_ID={{AZURE_TENANT_ID}}
OAUTH_CLIENT_ID={{S2S_CLIENT_ID}}
OAUTH_CLIENT_SECRET={{S2S_CLIENT_SECRET}}
OAUTH_SCOPE={{S2S_OAUTH_SCOPE}}

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
RATE_LIMIT_MAX=100
AUTH_RATE_LIMIT_MAX=5

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
LOG_LEVEL=info
LOG_FORMAT=combined

# -----------------------------------------------------------------------------
# OpenTelemetry (optional)
# -----------------------------------------------------------------------------
OTEL_ENABLED=false
OTEL_SERVICE_NAME=aim-api
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
